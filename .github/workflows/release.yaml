on:
    release:
      types: published
jobs:
    build:
      runs-on: ubuntu-latest
  
      steps:
        - uses: actions/checkout@v4
  
        - name: Set up Python 3.8
          uses: actions/setup-python@v5
          with:
            python-version: 3.8
  
        - name: Install qgis-plugin-ci
          run: pip3 install qgis-plugin-ci

        - name: Deploy plugin
          run: >-
            qgis-plugin-ci
            release --release-tag ${GITHUB_REF/refs\/tags\//}
            --github-token "$GITHUB_TOKEN"
            --osgeo-username "$OSGEO_USER"
            --osgeo-password "$OSGEO_PASSWORD"
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            OSGEO_USER: ${{ secrets.OSGEO_USER }}
            OSGEO_PASSWORD: ${{ secrets.OSGEO_PASSWORD }}